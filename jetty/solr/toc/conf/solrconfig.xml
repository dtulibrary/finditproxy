<?xml version="1.0" encoding="UTF-8"?>
<config>
    <abortOnConfigurationError>${solr.abortOnConfigurationError:true}</abortOnConfigurationError>
    <luceneMatchVersion>LUCENE_40</luceneMatchVersion>
    <dataDir>${solr.data.dir:}</dataDir>
    <directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.StandardDirectoryFactory}"/>

    <indexConfig>
        <useCompoundFile>false</useCompoundFile>
        <ramBufferSizeMB>1024</ramBufferSizeMB>
        <mergeFactor>10</mergeFactor>
        <maxBufferedDocs>1073741824</maxBufferedDocs>
        <unlockOnStartup>false</unlockOnStartup>
        <reopenReaders>true</reopenReaders>
        <maxFieldLength>32768</maxFieldLength>
        <writeLockTimeout>1000</writeLockTimeout>
        <commitLockTimeout>10000</commitLockTimeout>
        <lockType>native</lockType>

        <mergePolicy class="org.apache.lucene.index.TieredMergePolicy">
            <int name="maxMergeAtOnceExplicit">30</int>
            <int name="maxMergeAtOnce">10</int>
            <double name="segmentsPerTier">20</double>
            <double name="maxMergedSegmentMB">20000</double>            
        </mergePolicy>

        <mergeScheduler class="org.apache.lucene.index.ConcurrentMergeScheduler">            
            <int name="maxMergeCount">8</int>
            <int name="maxThreadCount">8</int>
        </mergeScheduler>

    </indexConfig>

    <updateHandler class="solr.DirectUpdateHandler2" />
    <requestHandler name="/update" class="solr.UpdateRequestHandler"/>

    <requestDispatcher handleSelect="true">
        <requestParsers enableRemoteStreaming="false"
                        multipartUploadLimitInKB="2048000"/>
        <httpCaching never304="true"/>
    </requestDispatcher>

    <query>
        <queryResultWindowSize>30</queryResultWindowSize>
        <useColdSearcher>false</useColdSearcher>
        <maxWarmingSearchers>2</maxWarmingSearchers>

        <filterCache class="solr.FastLRUCache"
                     size="20480"
                     initialSize="10240"
                     autowarmCount="10240"/>

        <queryResultCache class="solr.LRUCache"
                          size="2048"
                          initialSize="1024"
                          autowarmCount="1024"/>

        <documentCache class="solr.LRUCache"
                       size="2048"
                       initialSize="1024"
                       autowarmCount="1024"/>

        <fieldValueCache class="solr.FastLRUCache"
                         size="2048"
                         autowarmCount="1024"
                         showItems="32"/>

        <listener event="firstSearcher" class="solr.QuerySenderListener"/>
        <listener event="newSearcher" class="solr.QuerySenderListener"/>
    </query>
        
    <requestHandler name="search" class="solr.SearchHandler" default="true">
        <lst name="defaults">
            <str name="echoParams">explicit</str>
            <str name="fl">*</str>
            <str name="sort">issn asc,year desc,vol desc,issue asc</str>
        </lst>
    </requestHandler>
    
    <requestHandler name="/replication" class="solr.ReplicationHandler">
        <lst name="master">
            <str name="replicateAfter">startup</str>
            <str name="replicateAfter">commit</str>
            <str name="replicateAfter">optimize</str>
        </lst>
    </requestHandler>

    <requestHandler name="/admin/"
                    class="solr.admin.AdminHandlers"/>

    <!-- Legacy config for the admin interface -->
    <admin>
        <defaultQuery>*:*</defaultQuery>
    </admin>

</config>
