<?xml version="1.0" encoding="UTF-8"?>
<config>
    <abortOnConfigurationError>${solr.abortOnConfigurationError:true}</abortOnConfigurationError>
    <luceneMatchVersion>LUCENE_40</luceneMatchVersion>
    <dataDir>${solr.data.dir:}</dataDir>
    <directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.StandardDirectoryFactory}"/>

    <indexConfig>
        <useCompoundFile>false</useCompoundFile>
        <ramBufferSizeMB>64</ramBufferSizeMB>
        <mergeFactor>10</mergeFactor>
        <maxBufferedDocs>1073741824</maxBufferedDocs>
        <unlockOnStartup>false</unlockOnStartup>
        <reopenReaders>true</reopenReaders>
        <maxFieldLength>32768</maxFieldLength>
        <writeLockTimeout>1000</writeLockTimeout>
        <commitLockTimeout>10000</commitLockTimeout>
        <lockType>native</lockType>

        <mergePolicy class="org.apache.lucene.index.TieredMergePolicy">
            <int name="maxMergeAtOnceExplicit">30</int>
            <int name="maxMergeAtOnce">10</int>
            <double name="segmentsPerTier">20</double>
            <double name="maxMergedSegmentMB">20000</double>            
        </mergePolicy>

        <mergeScheduler class="org.apache.lucene.index.ConcurrentMergeScheduler">            
            <int name="maxMergeCount">8</int>
            <int name="maxThreadCount">8</int>
        </mergeScheduler>

    </indexConfig>

    <updateHandler class="solr.DirectUpdateHandler2" />
    <requestHandler name="/update" class="solr.UpdateRequestHandler"/>

    <!-- FIXME element used as xpointer scheme not supported, possibly use id instead -->
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/1)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/2)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/3)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/4)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/5)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/6)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/7)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/8)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/9)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/10)"/>
    <xi:include href="search_handlers.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(/1/11)"/>

	<requestHandler name="/primo" class="solr.SearchHandler" default="false">
        <lst name="defaults">
            <xi:include href="ds.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <str name="defType">edismax</str>
            <str name="echoParams">explicit</str>

            <str name="fq">format:article</str>

            <str name="mm">100%</str>
            <str name="q.op">AND</str>

            <str name="df">spell</str>
            <str name="fl">*,score</str>

            <str name="f.title.qf">title_t</str>
            <str name="f.creatorcontrib.qf">author_t</str>
            <str name="f.journal_title.qf">journal_title_s</str>
            <str name="f.creation_date.qf">pub_date_ti</str>
            <str name="f.isbn.qf">isbn_s</str>
            <str name="f.issn.qf">issn_s</str>
            <str name="f.subject.qf">keywords_t</str>

            <str name="facet">true</str>
            <str name="facet.field">{!key=creationdate}pub_date_sort</str>
            <str name="facet.field">{!key=creator}author_facet</str>
            <str name="facet.field">{!key=jtitle}journal_title_s</str>
            <str name="facet.field">{!key=type}format</str>
            <str name="facet.field">{!key=topic}keywords_facet</str>
            <str name="facet.field">{!key=lang}iso_language_s</str>
            <str name="facet.mincount">1</str>
        </lst>
    </requestHandler> 

    <requestHandler name="/replication" class="solr.ReplicationHandler">
        <lst name="master">
            <str name="replicateAfter">startup</str>
            <str name="replicateAfter">commit</str>
            <str name="replicateAfter">optimize</str>
        </lst>
    </requestHandler>

    <requestHandler name="/admin/"
                    class="solr.admin.AdminHandlers"/>

    <!-- Legacy config for the admin interface -->
    <admin>
        <defaultQuery>*:*</defaultQuery>
    </admin>

</config>
